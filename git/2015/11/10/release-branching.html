<!DOCTYPE html>
<html><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" type="image/png" href="/assets/images/favicon.png">
  <link rel="stylesheet" href="/assets/css/main.css">
  <script src="https://cdn.jsdelivr.net/npm/anchor-js/anchor.min.js"></script>
  <script src="/assets/js/main.js"></script>
  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Release Branching | RoleModel Software Best Practices</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Release Branching" />
<meta name="author" content="Caleb Woods, Jeff Terrell" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Release Based Branching Strategy" />
<meta property="og:description" content="Release Based Branching Strategy" />
<link rel="canonical" href="https://rolemodel.design/git/2015/11/10/release-branching.html" />
<meta property="og:url" content="https://rolemodel.design/git/2015/11/10/release-branching.html" />
<meta property="og:site_name" content="RoleModel Software Best Practices" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-11-10T04:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Release Branching" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Caleb Woods, Jeff Terrell"},"dateModified":"2015-11-10T04:00:00+00:00","datePublished":"2015-11-10T04:00:00+00:00","description":"Release Based Branching Strategy","headline":"Release Branching","mainEntityOfPage":{"@type":"WebPage","@id":"https://rolemodel.design/git/2015/11/10/release-branching.html"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://rolemodel.design/assets/images/logo.svg"},"name":"Caleb Woods, Jeff Terrell"},"url":"https://rolemodel.design/git/2015/11/10/release-branching.html"}</script>
<!-- End Jekyll SEO tag -->

</head>
<body class="app-with-sidebar"><div id="sidebar-menu" class="sidebar-primary sidebar--drawer sidebar--mobile-friendly">
  <div class="sidebar-menu-button-container">
    <span class="sidebar-menu-button material-symbols-outlined icon--x-large">close</span>
  </div>
  <a class="sidebar__brand" href="/">
    <img src="/assets/images/logo.svg">
  </a>

  <div class="sidebar__content sidebar__content--start">
    <div class="sidebar__section-title">Introduction</div>
    <a class="sidebar__item " href="/">
      <span class="material-symbols-outlined sidebar__item-icon" title="home">home</span>
      <div class="sidebar__item-label">Home</div>
    </a><a class="sidebar__item "
      href="/about/">
      <span class="material-symbols-outlined sidebar__item-icon" title="info">info</span>
      <div class="sidebar__item-label">About</div>
    </a><a class="sidebar__item " href="/all-posts">
      <span class="material-symbols-outlined sidebar__item-icon" title="feed">feed</span>
      <div class="sidebar__item-label">All Posts</div>
    </a>

    <div class="sidebar__section-title">Topics</div>
    <a class="sidebar__item "
      href="/rails/">
      <span class="material-symbols-outlined sidebar__item-icon" title="train">train</span>
      <div class="sidebar__item-label">Rails</div>
    </a><a class="sidebar__item active"
      href="/git/">
      <span class="material-symbols-outlined sidebar__item-icon" title="code">code</span>
      <div class="sidebar__item-label">Git</div>
    </a><a class="sidebar__item "
      href="/patterns/">
      <span class="material-symbols-outlined sidebar__item-icon" title="texture">texture</span>
      <div class="sidebar__item-label">Patterns</div>
    </a><a class="sidebar__item "
      href="/support/">
      <span class="material-symbols-outlined sidebar__item-icon" title="support_agent">support_agent</span>
      <div class="sidebar__item-label">Support</div>
    </a><a class="sidebar__item "
      href="/devops/">
      <span class="material-symbols-outlined sidebar__item-icon" title="dns">dns</span>
      <div class="sidebar__item-label">DevOps</div>
    </a><a class="sidebar__item "
      href="/presentations/">
      <span class="material-symbols-outlined sidebar__item-icon" title="co_present">co_present</span>
      <div class="sidebar__item-label">Presentations</div>
    </a><a class="sidebar__item "
      href="/testing/">
      <span class="material-symbols-outlined sidebar__item-icon" title="bug_report">bug_report</span>
      <div class="sidebar__item-label">Testing</div>
    </a></div>
</div>
<div id="app-body" class="app-body"><header class="app__header" role="banner">
  <div class="app__header-navigation">
    <span class="sidebar-menu-button material-symbols-outlined icon--x-large">menu</span>
  </div>
  <div class="app__header-title">
    <span>RoleModel Software Best Practices</span>
  </div>
  <div class="app__header-actions"></div>
</header>
<div class="app__content">
      <div class="post-body">
  <article class="card margin-y-md full-width" itemscope itemtype="http://schema.org/BlogPosting">
    <header class="card__header">
      <h1 class='post-title' itemprop="name headline">Release Branching</h1>
      <div class="post-meta"><time class="post-meta__date" datetime="2015-11-10T04:00:00+00:00" itemprop="datePublished">Nov 10, 2015
        </time><p class="post-meta__data">Author: Caleb Woods, Jeff Terrell</p><p class="post-meta__data">Approver: Ken Auer, Caleb Woods</p></div>
    </header>

    <div class="card__body" itemprop="articleBody">
      <h2 id="release-based-branching-strategy">Release Based Branching Strategy</h2>

<p>This document outlines the use of a “release branch” to collect features
intended for a specific release before they are merged into the master branch,
including tradeoffs of release branches and an extended example of applying a
hotfix.</p>

<h2 id="overview">Overview</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       H hotfix
       o
A   B /
o---o master
     \
      C   D   E
      o---o---o  release
           \
            F
            o feature
</code></pre></div></div>

<h2 id="principles">Principles</h2>

<ul>
  <li><strong>master</strong> is always the clean deployable branch for production.</li>
  <li><strong>release branches</strong> are started for each planned released.</li>
  <li><strong>feature branches</strong> are created off a <strong>release branch</strong> and commits are
typically squashed prior to merging back to <strong>release branch</strong>.</li>
</ul>

<h2 id="tradeoffs">Tradeoffs</h2>

<p>Note: some projects at RoleModel do not have a release branch and instead merge
feature branches directly into <code class="language-plaintext highlighter-rouge">master</code>. What are the tradeoffs of this
decision?</p>

<ul>
  <li>Without a release branch, it’s harder (though not impossible) to maintain the
property that <code class="language-plaintext highlighter-rouge">master</code> should always be ready for deploying to production. If
you don’t maintain that property, it requires more discipline to know which
commits on <code class="language-plaintext highlighter-rouge">master</code> are safe for deployment.</li>
  <li>With a release branch, it’s harder to apply hotfixes. A thorough example of
the process is described below, including the necessary use of <code class="language-plaintext highlighter-rouge">git rebase
--onto</code>. Without a release branch, rebasing atop a hotfix is no different
than rebasing atop a merged feature.</li>
</ul>

<h2 id="release-branches">Release branches</h2>

<p>Release branches are created off of master and will be “long running” branches
while features are being worked on for a release.  Ideally they should not run
longer than a release.</p>

<p>The naming for release branches will follow the following format
<code class="language-plaintext highlighter-rouge">release_&lt;release-month&gt;_&lt;release-year&gt;</code>, <code class="language-plaintext highlighter-rouge">release_october_2015</code>.  Note that
you can have multiple <strong>release branches</strong> at once, rebase will be used to
update them as things change.</p>

<h2 id="feature-branches">Feature branches</h2>

<p>Feature branches are created off of the release branch they will be merged
into.  Work on a branch should be scoped to a single ticket or sub task and
broken into logical commits.</p>

<p>After code review is approved on a branch, the commits should be squashed
according to the <a href="squashing">Squashing Commits</a> best practice.</p>

<h2 id="hotfixes">Hotfixes</h2>

<p>When a bug is discovered that needs an urgent fix deployed to production,
create a hotfix branch from <code class="language-plaintext highlighter-rouge">master</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       H hotfix
       o
A   B /
o---o master
     \
      C   D   E
      o---o---o  release
</code></pre></div></div>

<p>When the hotfix is ready, merge it into master and deploy to production:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A   B   H
o---o---o master
     \
      C   D   E
      o---o---o release
</code></pre></div></div>

<p>Next, you need to incorporate the hotfix into the <code class="language-plaintext highlighter-rouge">release</code> branch:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git checkout release
$ git rebase master
</code></pre></div></div>

<p>This will result in:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A   B   H
o---o---o master
         \
          C'  D'  E'
          o---o---o release
</code></pre></div></div>

<p>After the rebase all team members will need to reset their local release branch
to match the remote.</p>

<p>This can be done using <code class="language-plaintext highlighter-rouge">git reset --hard</code> or deleting and re-checking out the
branch.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git fetch
$ git checkout release
$ git reset --hard origin/release
</code></pre></div></div>

<p>or</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git branch -D release
$ git fetch
$ git checkout release
</code></pre></div></div>

<h3 id="syncing-with-other-developers">Syncing with other developers</h3>

<p>Finally, tell the other developers on the project to reset their local release
branches to the remote release branch, since the history of the remote release
branch has changed. Assuming the developer has no unpushed commits on their
local release branch:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git checkout release
$ git fetch
$ git reset --hard origin/release
</code></pre></div></div>

<p>Otherwise, if they do have unpushed commits on their local release branch, the
following will work in most cases (but you can <code class="language-plaintext highlighter-rouge">git show origin/release@{1}</code> or
even <code class="language-plaintext highlighter-rouge">git log origin/release@{1}..</code> to see which commits you’re about to rebase
onto <code class="language-plaintext highlighter-rouge">origin/release</code>; do <code class="language-plaintext highlighter-rouge">git reflog --help</code> for more info):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git checkout release
$ git fetch
$ git rebase --onto origin/release origin/release@{1}
</code></pre></div></div>

<h2 id="rebasing-feature-branches">Rebasing feature branches</h2>

<p>In addition when this rebase happens all outstanding <strong>feature branches</strong> will
need to be rebased using <code class="language-plaintext highlighter-rouge">git rebase --onto</code>.  See this <a href="http://www.calebwoods.com/2014/07/02/rebasing-dependent-feature-branches/">blog
post</a>
for some details. Note: this is complicated stuff. If in doubt, ask your
project craftsman for help.</p>

<p>Here is a simple example before the <strong>release branch</strong> is rebased:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A   B   H
o---o---o master
     \
      C   D
      o---o  release
           \
            F
            o feature
</code></pre></div></div>

<p>After rebasing the <strong>release branch</strong> your state will look like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A   B   H
o---o---o master
     \   \
      \   C'  D'
       \  o---o  release
        \
         C   D   F
         o---o---o feature
</code></pre></div></div>

<p>To clean up use <code class="language-plaintext highlighter-rouge">git rebase --onto</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git checkout feature
$ git rebase --onto release F^
</code></pre></div></div>

<p>Which will result in:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A   B   H
o---o---o master
         \
          C'  D'
          o---o  release
               \
                F'
                o feature
</code></pre></div></div>

<p>If you have more than one commit unique to the feature branch, <code class="language-plaintext highlighter-rouge">F</code> should be
the first (i.e. earliest) of them. If you don’t know which one that is, you
have a few options:</p>

<ul>
  <li>If you haven’t pushed master to origin yet, then <code class="language-plaintext highlighter-rouge">git log --oneline
origin/master..feature</code> will list the commits that are in the <code class="language-plaintext highlighter-rouge">feature</code>
branch and not in the <code class="language-plaintext highlighter-rouge">origin/master</code> branch.</li>
  <li>Rely on <code class="language-plaintext highlighter-rouge">git log</code> and your memory.</li>
  <li>If all else fails, you can use the git reflog to tell you what commit the
<code class="language-plaintext highlighter-rouge">release</code> branch used to point to. If you followed these instructions,
<code class="language-plaintext highlighter-rouge">release@{1}</code> will be the commit the <code class="language-plaintext highlighter-rouge">release</code> branch pointed to before it
was rebased. Assuming that’s true, <code class="language-plaintext highlighter-rouge">git log release@{1}..feature</code> will list
the commits unique to the feature branch, which you can use to find your <code class="language-plaintext highlighter-rouge">F</code>.</li>
</ul>

    </div>

    <a class="u-url" href="/git/2015/11/10/release-branching.html" hidden></a>
  </article>

  <div class="table-of-contents">
    <p class="table-of-contents__title">Table of Contents</p>
    <ul id="table-of-contents" class="table-of-contents__nav">
<li class="table-of-contents__item table-of-contents-h2"><a href="#release-based-branching-strategy">Release Based Branching Strategy</a></li>
<li class="table-of-contents__item table-of-contents-h2"><a href="#overview">Overview</a></li>
<li class="table-of-contents__item table-of-contents-h2"><a href="#principles">Principles</a></li>
<li class="table-of-contents__item table-of-contents-h2"><a href="#tradeoffs">Tradeoffs</a></li>
<li class="table-of-contents__item table-of-contents-h2"><a href="#release-branches">Release branches</a></li>
<li class="table-of-contents__item table-of-contents-h2"><a href="#feature-branches">Feature branches</a></li>
<li class="table-of-contents__item table-of-contents-h2"><a href="#hotfixes">Hotfixes</a>
<ul class="table-of-contents__sub-nav">
<li class="table-of-contents__item table-of-contents-h3"><a href="#syncing-with-other-developers">Syncing with other developers</a></li>
</ul>
</li>
<li class="table-of-contents__item table-of-contents-h2"><a href="#rebasing-feature-branches">Rebasing feature branches</a></li>
</ul>
  </div>
</div>

    </div>
  </div>
</body>

</html>
